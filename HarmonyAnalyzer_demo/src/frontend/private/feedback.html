<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="フィードバック - 音声解析／可視化 UI">
  <title>フィードバック</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com" defer></script>

  <!-- Chart.js UMD（グローバルに window.Chart を生やす） -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>

  <!-- プラグイン（Chart本体の後） -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.1/dist/chartjs-plugin-annotation.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js" defer></script>

  <!-- CSS -->
  <link rel="stylesheet" href="feedback.css"/>
  <link rel="stylesheet" href="base.css"/>
</head>

<body class="page-feedback bg-gray-50 text-gray-800">
  <div class="container mx-auto p-4 space-y-4">
    <!-- ページ見出し -->
    <h1 class="text-xl font-bold card-header">フィードバック</h1>

    <!-- コントロール群 -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <label class="flex flex-col gap-1" for="bpmInput">
        <span class="text-sm text-muted">BPM</span>
        <input id="bpmInput" type="number" value="120" min="20" max="400" step="1" class="border rounded p-2"/>
      </label>

      <label class="flex flex-col gap-1" for="beatsInput">
        <span class="text-sm text-muted">拍子</span>
        <input id="beatsInput" type="number" value="4" min="1" max="16" step="1" class="border rounded p-2"/>
      </label>

      <label class="flex flex-col gap-1" for="baseAInput">
        <span class="text-sm text-muted">基準A (Hz)</span>
        <input id="baseAInput" type="number" value="442" min="400" max="480" step="0.1" class="border rounded p-2"/>
      </label>

      <div class="flex items-end">
        <button id="updateBtn" class="w-full btn-primary text-white rounded px-4 py-2">更新</button>
      </div>
    </div>

    <!-- ピッチチャート -->
    <div class="card" id="pitchCard">
      <div class="card-header">音程</div>
      <div class="card-body">
        <!-- チャートとY軸スライダー -->
        <div class="pitch-chart-wrap">
          <canvas id="pitchChart" class="pitch-canvas" role="img" aria-label="ピッチチャート">
            あなたのブラウザは canvas をサポートしていません。
          </canvas>

          <!-- Y軸スライダー（必要な時だけ表示） -->
          <div id="ySliderOverlay" aria-hidden="true" style="display:none;">
            <div class="vslider-wrapper" role="region" aria-label="Y軸スクロール">
              <label for="yAxisSlider" class="sr-only">Y軸スクロール</label>
              <input type="range" id="yAxisSlider" class="vslider"
                min="0" max="100" value="0"
                aria-orientation="vertical" aria-label="Y軸スクロール">
            </div>
          </div>
        </div>

        <!-- 赤バースライダー -->
        <label for="redBarSlider" class="sr-only">赤バー位置</label>
        <input type="range" id="redBarSlider" min="0" max="100" value="0" aria-label="赤バー位置">
      </div>
    </div>

    <!-- X軸スクロールバー -->
    <div class="relative h-20 card">
      <canvas id="xScrollBar" class="w-full h-full" role="img" aria-label="X軸ミニマップ">
        ミニマップはサポートされていません
      </canvas>
    </div>

    <!-- レーダーチャート -->
    <div class="flex gap-4 items-stretch">
      
      <!-- レーダーチャート -->
      <div class="flex-2 card">
        <div class="card-header not-italic inline-block">音色</div>
        <canvas id="radarChart" class="max-w-full max-h-[400px]" role="img" aria-label="レーダーチャート">
          レーダーチャートはサポートされていません
        </canvas>
      </div>

      <!-- 音量比率 & 協調度, 音源プレイヤー -->
      <div class="flex-1 flex flex-col gap-2 min-w-[220px]">
        <section class="card p-2">
          <div class="card-header">音量</div>
          <div id="volumeRatios" class="flex flex-col gap-1">
            <div class="volume-row flex justify-between items-center text-xs">
              <div class="volume-label">あなた</div>
              <progress max="100" value="65" class="flex-1 mx-2 h-2"
                        aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></progress>
              <div class="progress-value">65%</div>
            </div>
            <div class="volume-row flex justify-between items-center text-xs">
              <div class="volume-label">相手</div>
              <progress max="100" value="35" class="flex-1 mx-2 h-2"
                        aria-valuenow="35" aria-valuemin="0" aria-valuemax="100"></progress>
              <div class="progress-value">35%</div>
            </div>
          </div>
        </section>

        <section class="card flex-1 flex flex-col p-2 min-h-[200px]">
          <div class="card-header">協調度</div>
          <div id="cooperationRatios" class="flex-1 overflow-auto" aria-live="polite"></div>
        </section>

        <div class="player-container card p-3">
          <div id="audioPlayersContainer" class="space-y-4">
            <div id="fileNameDisplay" class="card-header">
              お使いのブラウザは audio 要素に対応していません。
            </div>
          </div>
        </div>        
        
      </div>
    </div>
  </div>


  <!-- 下部ナビゲーション -->
  <div class="bottom-nav" role="navigation" aria-label="下部ナビゲーション">
    <button class="nav-btn" id="MicBtn" aria-label="録音">
      <div class="icon-wrap"><img src="image/mic-icon.png" alt="録音"></div>
      <div class="nav-label">録音</div>
    </button>

    <button class="nav-btn" id="FldBtn" aria-label="フォルダ">
      <div class="icon-wrap"><img src="image/folder-icon.png" alt="フォルダ"></div>
      <div class="nav-label">フォルダ</div>
    </button>

    <button class="nav-btn" id="SetBtn" aria-label="設定">
      <div class="icon-wrap"><img src="image/settings-icon.png" alt="設定"></div>
      <div class="nav-label">設定</div>
    </button>
  </div>

  <!-- アプリ本体スクリプト -->
  <script type="module" src="./feedback/main.js"></script>
</body>
</html>

